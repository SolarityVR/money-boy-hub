<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Solarity</title>
    <meta name="description"
          content="Advanced Hello World, WebXR! A-frame provides a hello world that is really remarkable, however you usually need to have controller selection and environment with movement.  With this example you get what works across the most headsets and controllers.">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="gray-translucent" />
    <!-- *** CHANGE THESE TO COMPONENTS ON YOUR SERVER *** -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

    <script>
        //a link cmponent to make aframe elements linkable in another page
        AFRAME.registerComponent('simple-link', {
            schema: {
                href: { default: '' },
                target: { default: '_blank' }
            },
            init: function () {
                this.el.addEventListener('click', (e) => {
                    window.open(this.data.href, this.data.target);
                    console.log(this.data.href)
                });
            }
        });
    </script>

</head>

<body>
    <div id="loading_screen"
         style="padding-top: 30%; height: 100%; width: 100%; background-color: #9944BB; top: 50%; left: 50%; transform: translate(-50%, -50%); position: fixed;">
        <div id="loading_text"
             style="font-family: monospace; color: #44FFFF; width: 80vw; font-size: 4em; text-align: center; margin:auto">
        </div>
        <div id="loading_bar" style="height: 14px; width: 80vw; margin:auto; border: solid 2px #44FFFF;">
        </div>
    </div>
    <div id="scene_wrapper" style="opacity: 0;">
        <a-scene loading-screen="enabled:false" stats>
            <!-- assets management system -->
            <a-assets>
                <a-asset-item id="room-glb" src="assets/models/roomlights.glb"></a-asset-item>
                <a-asset-item id="globe-glb" src="assets/models/Hologram_sphere.glb"></a-asset-item>
                <a-asset-item id="navmesh-gltf" src="assets/models/navmesh1.gltf"></a-asset-item>
                <video id="try" autoplay loop="true" src="assets/videos/try.mp4"></video>
                <img id="try-img" src="assets/images/japan.png">

            </a-assets>

            <!-- basic movement  -->
            <a-entity id="cameraRig" movement-controls="constrainToNavMesh: true;" position="0 0 0" rotation="0 0 0">
                <!-- camera -->
                <a-entity id="head" camera="fov: 80; active: true" position="0 1.6 0"
                          look-controls="pointerLockEnabled: true; reverseMouseDrag: false">
                    <a-entity id="cursor" cursor raycaster="far: 10; objects: .clickable"
                              material="color: white; shader: flat" position="0 0 -0.3"
                              geometry="primitive: sphere; radius: 0.001">
                    </a-entity>
                </a-entity>
            </a-entity>

            <!-- lights  -->
            <!-- ambient light  -->
            <a-entity light="type: ambient; intensity: 0; color:  #FFFFFF; shadowCameraVisible: false;"></a-entity>
            <!-- table lights  -->
            <a-entity light="type:point; color:  #FFFFFF; intensity: 1; distance: 10; decay: 1;" position="3 3 0">
            </a-entity>
            <a-entity light="type:point; color:  #FFFFFF; intensity: 1; distance: 10; castShadow: false; decay: 1"
                      position="-2.5 3 4.6">
            </a-entity>
            <a-entity light="type:point; color:  #FFFFFF; intensity: 1; distance: 10; castShadow: false; decay: 1"
                      position="-2.5 3 -4.6">
            </a-entity>
            <a-entity light="type:point; color:  #FFFFFF; intensity: 1; distance: 10; castShadow: false; decay: 1"
                      position="8.7 3 4.6">
            </a-entity>
            <a-entity light="type:point; color:  #FFFFFF; intensity: 1; distance: 10; castShadow: false; decay: 1"
                      position="8.7 3 -4.6">
            </a-entity>
            <!-- statue lights -->
            <a-entity light="type:spot; angle: 90; color:  #DDAAFF; intensity: 1; distance: 50; decay: 1; "
                      rotation="-90 0 0" position="-12 5.5 0">
            </a-entity>
            <a-entity light="type:spot; angle: 90; color:  #DDAAFF; intensity: 1; distance: 10; decay: 1; "
                      rotation="-90 0 0" position="-8 5.5 0">
            </a-entity>
            <a-entity light="type:spot; angle: 90; color:  #DDAAFF; intensity: 1; distance: 50; decay: 1; "
                      rotation="-90 0 0" position="14 5.5 0">
            </a-entity>

            <!-- models  -->
            <!-- room  -->
            <a-entity id="room" class="model" gltf-model="#room-glb"
                      material="roughness: 70; metalness: 0; shader: standard">
            </a-entity>
            <!-- globe  -->
            <a-entity id="globe" class="model" gltf-model="#globe-glb"
                      material="roughness: 70; metalness: 0; shader: standard"
                      animation__spin="property: rotation; dur: 12000; loop: true; to: 0 360 0;" position="3 1.5 0">
            </a-entity>
            <!-- nav-mesh: protecting us from running thru walls  -->
            <a-entity id="navmesh" class="model" gltf-model="#navmesh-gltf" nav-mesh visible="false">
            </a-entity>

            <!-- big screen  -->
            <a-plane width="6.4" height="3.5" rotation="0 180 0" material="shader: standard;" position="3 2.4 7.4"
                     color="#111122">
                <a-video src="#try" rotation="0 -180 0" width="6.4" height="3.5" position="0 0 0.01"></a-video>
            </a-plane>

            <!-- average screen left  -->
            <a-plane id="nft" width="3" height="3.5" rotation="0 0 0" material="shader: flat;" position="1.3 2.4 -7.4"
                     color="#EE22FF">
                <!-- title  -->
                <a-text align="center" rotation="0 0 0" width="2.9" value="FLOOR PRICE" position="0 -0.7 0.01"
                        x-offset="0.05" wrap-count="20" color="#AAEEFF"></a-text>
            </a-plane>

            <!-- average screen right -->
            <a-plane id="twitter" width="3" height="3.5" rotation="0 0 0" material="shader: flat;"
                     position="4.7 2.4 -7.4" color="#EE22FF">
                <!-- title  -->
                <a-text align="center" rotation="0 0 0" width="2.9" value="TWITTER" position="0 1.6 0.01"
                        x-offset="0.05" wrap-count="30" color="#AAEEFF"></a-text>
                <!-- arrows  -->
                <a-plane text="value: up; wrap-count: 6; align: center" width=".15" height=".15" id="scroll_twitter_up"
                         class="clickable nocollision" material="shader: flat;" color="#44AABB"
                         position="1.35 -1.35 0.02">
                </a-plane>
                <a-plane text="value: down; wrap-count: 6; align: center" width=".15" height=".15"
                         id="scroll_twitter_down" class="clickable nocollision" material="shader: flat;" color="#44AABB"
                         position="1.35 -1.55 0.02">
                </a-plane>
            </a-plane>

            <!-- tiny screen right -->
            <a-plane position="-13.21 2.75 4.33" width="1.5" height="1.75" rotation="0 133.25 0"
                     material="shader: standard;" color="#111122">
                <a-image width="1.5" height="1.75" position="0 0 0.01"
                         src="assets\images\ffc2b2a0-614a-4359-b164-68c5b9f4396d.jpg"></a-image>
            </a-plane>
            <!-- tiny screen left -->
            <a-plane position="-13.22 2.75 -4.3" width="1.5" height="1.75" rotation="0 46.75 0"
                     material="shader: standard;" color="#111122">
                <a-image width="1.5" height="1.75" position="0 0 0.01" src="assets/images/media_FKNOb38VgAkOruy.jpg">
                </a-image>
            </a-plane>
            <!-- tiny screen center -->
            <a-plane position="-14.445 2.75 0" width="1.5" height="1.75" rotation="0 90 0" material="shader: standard;"
                     color="#111122">
                <a-image width="1.5" height="1.75" position="0 0 0.01" src="assets/images/download.png"></a-image>
            </a-plane>

            <a-plane class="clickable nocollision" simple-link="href: https://www.google.com" scale="1.5 2 1" position="14.2 1.1 2.5"rotation="0 -90 0" material="background-color: #EE22FF; shader: portal; pano: assets/images/japan.png"></a-plane>

            <a-plane class="clickable nocollision" simple-link="href: https://www.google.com" scale="2.4 2.9 1" position="14.2 1.55 0"rotation="0 -90 0" material="background-color: #EE22FF; shader: portal; pano: assets/images/japan.png"></a-plane>

            <a-plane class="clickable nocollision" simple-link="href: https://www.google.com" scale="1.5 2 1" position="14.2 1.1 -2.5"rotation="0 -90 0" material="background-color: #EE22FF; shader: portal; pano: assets/images/japan.png"></a-plane>
        </a-scene>
    </div>
</body>
<!-- importing custom scripts  -->
<script src="scripts/custom/utils.js"></script>
<script src="scripts/custom/screens.js"></script>
<script>
    //acquiring sceneEL
    var sceneEl = document.querySelector('a-scene');
    var scene_wrapperEl = document.getElementById('scene_wrapper');
    var loading_screenEl = document.getElementById('loading_screen');
    var loading_textEl = document.getElementById('loading_text');
    var loading_barEl = document.getElementById('loading_bar');

    var bodyEl = document.querySelector('body');
    var models = [];
    var models_number;
    var models_loaded = 0;
    //basically builds all of the dinamic content
    function build_dynamic_content() {
        start_screens();
    }
    //checks if scene has loaded befor building all of the dinamic content
    function check_scene() {
        if (sceneEl.hasLoaded) {
            start_scene()
        } else {
            sceneEl.addEventListener('loaded', start_scene);
        }
    }
    //updates loading screen based on models actually loaded
    function update_loading_screen() {
        models_loaded += 1;
        loading_textEl.innerHTML = "MODELS LOADED: " + models_loaded + " / " + models_number;
        loading_barEl.innerHTML += "<div style='display: inline-block; border: solid 2px #9944BB; width:" + (80 / models_number) + "vw; height: 10px; background-color: #44FFFF'></div>"
        if (models_loaded == models_number) {
            scene_wrapperEl.removeAttribute("style");
        };
    }
    //checks if model has loaded before building all of the dinamic content
    function start_loading_screen_listeners() {
        models = document.getElementsByClassName("model");
        models_number = models.length;
        loading_textEl.innerHTML = "MODELS LOADED: 0 / " + models_number;
        for (i = 0; i < models_number; i++) {
            models[i].addEventListener("model-loaded", update_loading_screen)
        }
    }
    function start_scene() {
        build_dynamic_content();
        start_loading_screen_listeners();
    }
    start_scene();
</script>


</html>